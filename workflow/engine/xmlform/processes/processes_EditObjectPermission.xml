<?xml version="1.0" encoding="UTF-8"?>
<dynaForm name="processes_EditObjectPermission" width="100%" enableTemplate="1">
  <TITLE type="title">
    <en><![CDATA[Edit Specific Permission]]></en>
  </TITLE>
  <LANG type="private"/>
  <PRO_UID type="hidden"/>
  <OP_UID type="hidden"/>
  <OP_CASE_STATUS type="dropdown" mode="edit">
    <en><![CDATA[Status Case]]><option name="ALL"><![CDATA[ALL]]></option><option name="DRAFT"><![CDATA[DRAFT]]></option><option name="TO_DO"><![CDATA[TO_DO]]></option><option name="PAUSED"><![CDATA[PAUSED]]></option><option name="COMPLETED"><![CDATA[COMPLETED]]></option></en>
  </OP_CASE_STATUS>
  <TAS_UID type="dropdown" mode="edit"><![CDATA[SELECT TAS_UID, CON_VALUE AS TAS_TITLE FROM TASK LEFT JOIN CONTENT ON (TAS_UID = CON_ID AND CON_CATEGORY = 'TAS_TITLE' AND CON_LANG = @@LANG) WHERE PRO_UID = @@PRO_UID AND TAS_TYPE = 'NORMAL' ORDER BY TAS_TITLE]]><en><![CDATA[Target Task]]><option name=""><![CDATA[All Tasks]]></option></en></TAS_UID>
  <GROUP_USER type="text" mode="view">
    <en><![CDATA[Group or User]]></en>
  </GROUP_USER>
  <GROUP_USER_DROPDOWN type="title" mode="view" enableHtml="1" label="@#GROUP_USER"/>
  <OP_TASK_SOURCE type="dropdown" mode="edit"><![CDATA[SELECT TAS_UID, CON_VALUE AS TAS_TITLE FROM TASK LEFT JOIN CONTENT ON (TAS_UID = CON_ID AND CON_CATEGORY = 'TAS_TITLE' AND CON_LANG = @@LANG) WHERE PRO_UID = @@PRO_UID AND TAS_TYPE = 'NORMAL' ORDER BY TAS_TITLE]]><en><![CDATA[Origin Task]]><option name=""><![CDATA[All Tasks]]></option></en></OP_TASK_SOURCE>
  <OP_PARTICIPATE type="yesno" defaultvalue="1" mode="edit">
    <en><![CDATA[Participation required?]]></en>
  </OP_PARTICIPATE>
  <OP_OBJ_TYPE type="dropdown" mode="edit" dependentfields="OP_OBJ_UID">
    <en><![CDATA[Type]]><option name="ANY"><![CDATA[All]]></option><option name="DYNAFORM"><![CDATA[Dynaform]]></option><option name="INPUT"><![CDATA[Input Document]]></option><option name="OUTPUT"><![CDATA[Output Document]]></option><option name="CASES_NOTES"><![CDATA[Cases Notes]]></option><option name="MSGS_HISTORY"><![CDATA[Messages History]]></option></en>
  </OP_OBJ_TYPE>
  <ALL type="dropdown" mode="edit" sqlConnection="dbarray">
  SELECT * FROM allObjects
  <en><![CDATA[Object]]><option name=""><![CDATA[All]]></option></en>
</ALL>
  <DYNAFORMS type="dropdown" mode="edit" sqlConnection="dbarray">
  SELECT * FROM allDynaforms
  <en><![CDATA[DynaForm]]><option name=""><![CDATA[All]]></option></en>
</DYNAFORMS>
  <INPUTS type="dropdown" mode="edit" sqlConnection="dbarray">
  SELECT * FROM allInputs
  <en><![CDATA[Input Document]]><option name=""><![CDATA[All]]></option></en>
</INPUTS>
  <OUTPUTS type="dropdown" mode="edit" sqlConnection="dbarray">
  SELECT * FROM allOutputs
  <en><![CDATA[Output Document]]><option name=""><![CDATA[All]]></option></en>
</OUTPUTS>
  <OP_ACTION type="dropdown" mode="edit">
    <en><![CDATA[Permission]]><option name="VIEW"><![CDATA[View]]></option><option name="BLOCK"><![CDATA[Block]]></option><option name="DELETE"><![CDATA[Delete]]></option><option name="RESEND"><![CDATA[Resend]]></option></en>
  </OP_ACTION>
  <CREATE type="button" onclick="saveObjectPermission(this.form);">
    <en><![CDATA[Save]]></en>
  </CREATE>
  <ID_DELETE type="private"/>
  <ID_RESEND type="private"/>
  <JS type="javascript"><![CDATA[
var aOptions = [];
var getOptions = function() {
    var oAux = getField('OP_ACTION');
    for (var i = 0; i < oAux.options.length; i++) {
    if (oAux.options[i].value != 'DELETE' && oAux.options[i].value != 'RESEND') {
            aOptions.push({label:oAux.options[i].text, value: oAux.options[i].value});
        }
    }
};
var rebuildOptionsWhenLoad = function(sType) {
    var selectedValue = getField('OP_ACTION').value;
    var oAux = getField('OP_ACTION');
    while (oAux.options.length) {
        oAux.remove(0);
    }
    for (var i = 0; i < aOptions.length; i++) {
        var oOption = document.createElement('OPTION');
        oOption.value = aOptions[i].value;
        oOption.text = aOptions[i].label;
        if (oOption.value == selectedValue) {
          oOption.selected = true;
        }
        oAux.options.add(oOption);
    }

    switch (sType) {
        case 'INPUT':
        case 'OUTPUT':
            var oOption = document.createElement('OPTION');
            oOption.value = 'DELETE';
            oOption.text = '@#ID_DELETE';
            if (oOption.value == selectedValue) {
              oOption.selected = true;
            }
            oAux.options.add(oOption);
        break;
        case 'MSGS_HISTORY':
            var oOption = document.createElement('OPTION');
            oOption.value = 'RESEND';
            oOption.text = '@#ID_RESEND';
            if (oOption.value == selectedValue) {
              oOption.selected = true;
            }
            oAux.options.add(oOption);
        break;
        default:
        break;
    }

    oAux.value = selectedValue;
};
var rebuildOptions = function(sType) {
    var oAux = getField('OP_ACTION');
    while (oAux.options.length) {
        oAux.remove(0);
    }
    for (var i = 0; i < aOptions.length; i++) {
        var oOption = document.createElement('OPTION');
        oOption.value = aOptions[i].value;
        oOption.text = aOptions[i].label;
        oAux.options.add(oOption);
    }

    switch (sType) {
        case 'INPUT':
        case 'OUTPUT':
            var oOption = document.createElement('OPTION');
            oOption.value = 'DELETE';
            oOption.text = '@#ID_DELETE';
            oAux.options.add(oOption);
        break;
        case 'MSGS_HISTORY' :
            var oOption = document.createElement('OPTION');
            oOption.value = 'RESEND';
            oOption.text = '@#ID_RESEND';
            oAux.options.add(oOption);
        break;
        default:
        break;
    }

};
if (getField('OP_OBJ_TYPE').value=='ANY') {
    hideRowById('ALL' );
    hideRowById( 'DYNAFORMS' );
    hideRowById( 'INPUTS' );
    hideRowById( 'OUTPUTS' );
    showRowById( 'OP_ACTION' );
}
if (getField('OP_OBJ_TYPE').value=='DYNAFORM') {
    hideRowById( 'ALL' );
    hideRowById( 'INPUTS' );
    hideRowById( 'OUTPUTS' );
    showRowById( 'OP_ACTION' );
}
if (getField('OP_OBJ_TYPE').value=='INPUT') {
    hideRowById( 'ALL' );
    hideRowById( 'DYNAFORMS' );
    hideRowById( 'OUTPUTS' );
    showRowById( 'OP_ACTION' );
}
if (getField('OP_OBJ_TYPE').value=='OUTPUT') {
    hideRowById( 'ALL' );
    hideRowById( 'DYNAFORMS' );
    hideRowById( 'INPUTS' );
    showRowById( 'OP_ACTION' );
}
if (getField('OP_OBJ_TYPE').value=='CASES_NOTES') {
    hideRowById( 'ALL' );
    hideRowById( 'DYNAFORMS' );
    hideRowById( 'INPUTS' );
    hideRowById( 'OUTPUTS' );
    hideRowById( 'OP_ACTION' );
}
if (getField('OP_OBJ_TYPE').value=='MSGS_HISTORY') {
    hideRowById('ALL');
    hideRowById('DYNAFORMS');
    hideRowById('INPUTS');
    hideRowById('OUTPUTS');
    showRowById('OP_ACTION');
}

getOptions();
rebuildOptionsWhenLoad(getField('OP_OBJ_TYPE').value);

leimnud.event.add(document.getElementById('form[OP_OBJ_TYPE]'), 'change', function() {
    if (getField('OP_OBJ_TYPE').value=='DYNAFORM') {
        hideRowById( 'ALL' );
        hideRowById( 'INPUTS' );
        hideRowById( 'OUTPUTS' );
        showRowById( 'DYNAFORMS' );
        showRowById( 'OP_ACTION' );
    }
    if (getField('OP_OBJ_TYPE').value=='INPUT') {
        hideRowById( 'ALL' );
        hideRowById( 'DYNAFORMS' );
        hideRowById( 'OUTPUTS' );
        showRowById( 'INPUTS' );
        showRowById( 'OP_ACTION' );
    }
    if (getField('OP_OBJ_TYPE').value=='OUTPUT') {
        hideRowById( 'ALL' );
        hideRowById( 'DYNAFORMS' );
        hideRowById( 'INPUTS' );
        showRowById( 'OUTPUTS' );
        showRowById( 'OP_ACTION' );
    }
    if (getField('OP_OBJ_TYPE').value=='CASES_NOTES') {
        hideRowById( 'ALL' );
        hideRowById( 'DYNAFORMS' );
        hideRowById( 'INPUTS' );
        hideRowById( 'OUTPUTS' );
        hideRowById( 'OP_ACTION' );
    }
    if (getField('OP_OBJ_TYPE').value=='ANY') {
        hideRowById('ALL' );
        hideRowById( 'DYNAFORMS' );
        hideRowById( 'INPUTS' );
        hideRowById( 'OUTPUTS' );
        showRowById( 'OP_ACTION' );
    }
    if (getField('OP_OBJ_TYPE').value=='MSGS_HISTORY') {
        hideRowById('ALL');
        hideRowById('DYNAFORMS');
        hideRowById('INPUTS');
        hideRowById('OUTPUTS');
        showRowById('OP_ACTION');
    }

    rebuildOptions(getField('OP_OBJ_TYPE').value);
});

leimnud.event.add(document.getElementById('form[OP_CASE_STATUS]'), 'change', function() {
    var target = document.getElementById('form[TAS_UID]');
    var origin = document.getElementById('form[OP_TASK_SOURCE]');
    var participate = document.getElementById('form[OP_PARTICIPATE]');
    if (document.getElementById('form[OP_CASE_STATUS]').value=='COMPLETED') {
        hideRowById(target);
        hideRowById(origin);
        hideRowById(participate);
    } else {
        showRowById(target);
        showRowById(origin);
        showRowById(participate);
    }
});

]]></JS>
</dynaForm>
