version: 2
jobs:
 build:
   working_directory: ~/processmaker
   docker:
     - image: devopsstacks/pm:n225-phpunit
   resource_class: large
   branches:
     only:
       # Only executed circleci for this branch
       - develop
       - KR-7471
   steps:         
     - checkout
     - run: service mysqld restart
     - run: yum -y install php71-imap
     - run: mysql -u root -ppassword -e "create database test;"    
     - run: composer install
     - run:
        name: Run Test Units
        command: |
          set -e                  
          mkdir coverage
          vendor/phpunit/phpunit/phpunit --testdox-html coverage/result.html --coverage-html coverage  tests/unit/     
     - store_artifacts:
          path: coverage
          destination: coverage
        